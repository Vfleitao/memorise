syntax = "proto3";

package memorize;

// The Memorize cache service
service Memorize {
  // Get a value by key
  rpc Get(GetRequest) returns (GetResponse);
  
  // Set a value with TTL
  rpc Set(SetRequest) returns (SetResponse);
  
  // Delete a key
  rpc Delete(DeleteRequest) returns (DeleteResponse);
  
  // Delete all keys
  rpc DeleteAll(DeleteAllRequest) returns (DeleteAllResponse);
  
  // List all keys (non-expired)
  rpc Keys(KeysRequest) returns (KeysResponse);
  
  // Search keys by prefix with pagination
  rpc SearchKeys(SearchKeysRequest) returns (SearchKeysResponse);
  
  // Check if a key exists
  rpc Contains(ContainsRequest) returns (ContainsResponse);
}

// === Unary Request/Response Messages ===

message GetRequest {
  string key = 1;
}

message GetResponse {
  optional string value = 1;  // None if key doesn't exist or expired
}

message SetRequest {
  string key = 1;
  string value = 2;
  uint64 ttl_seconds = 3;  // Time-to-live in seconds (0 = never expire)
}

message SetResponse {
  bool success = 1;
}

message DeleteRequest {
  string key = 1;
}

message DeleteResponse {
  bool deleted = 1;  // true if key existed
}

message DeleteAllRequest {
  // Empty - no parameters needed
}

message DeleteAllResponse {
  uint64 deleted_count = 1;  // Number of entries deleted
}

message KeysRequest {
  optional string pattern = 1;  // Future: support pattern matching
  uint32 limit = 2;             // Maximum number of keys to return (0 = default limit)
}

message KeysResponse {
  repeated string keys = 1;
}

message SearchKeysRequest {
  string prefix = 1;          // Prefix to match keys against (empty = match all, max: 256 bytes)
  uint32 limit = 2;           // Maximum keys to return (0 = default of 50, max: 250)
  uint32 skip = 3;            // Number of matching keys to skip for pagination
}

message SearchKeysResponse {
  repeated string keys = 1;   // Matching keys, sorted alphabetically
  uint64 total_count = 2;     // Total number of matches (before skip/limit)
}

message ContainsRequest {
  string key = 1;
}

message ContainsResponse {
  bool exists = 1;
}
